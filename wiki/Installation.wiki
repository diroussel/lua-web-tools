#summary Explains how to compile and install LWT.
#labels Featured,Phase-Deploy

This page describes the installation of LWT on an Ubuntu Linux system. You may have to modify these instructions and the makefiles in order to compile and install LWT on other systems.

= Installation of `mod_lwt` =

== Prerequisites ==

Apache HTTP Server developement headers:

  * apache2-dev

Lua interpreter and header files:

  * lua5.1
  * liblua5.1-dev

To install these prerequisites:

{{{
$ sudo apt-get install apache2-dev lua5.1 liblua5.1-dev 
}}}

== Building and Installing ==

=== Checkout ===

{{{
svn checkout http://lua-web-tools.googlecode.com/svn/trunk lwt
cd lwt
}}}

=== Compile ===

{{{
cd mod_lwt
make
}}}

=== Install ===

{{{
sudo make install
cd ..
}}}

= Installation of the `is` module (optional) =

The `is` module provides an API to access information systems from Lua.

== Prerequisites ==

MySQL client headers:

  * libmysqlclient-dev

SQLite3 headers:

  * libsqlite3-dev

FreeTDS headers:

  * freetds-dev

To install these dependencies:

{{{
$ sudo apt-get install libmysqlclient-dev libsqlite3-dev freetds-dev
}}}

== Building and Installing ==

=== Compile ===

{{{
cd is
make
}}}

=== Install ===

The makefile installs the `is` module in `/usr/local/lib/lua/5.1`.

{{{
sudo make install
cd ..
}}}

= Installation of the `cache` module (optional) =

The `cache` module provides an API to access memcached from Lua.

== Prerequisites ==

memcached headers:

  * libmemcached-dev

To install this dependency:

{{{
$ sudo apt-get install libmemcached-dev 
}}}

== Building and Installing ==

=== Compile ===

{{{
cd cache
make
}}}

=== Install ===

The makefile installs the `cache` module in `/usr/local/lib/lua/5.1`.

{{{
sudo make install
cd ..
}}}

= Test =

To install `mod_lwt` globally, create `/etc/apache2/mods-available/lwt.conf` with the following content:

{{{
<IfModule mod_lwt.c>
AddHandler lwt .lua
</IfModule>
}}}

Then activate the module and restart the Apache HTTP Server:

{{{
$ sudo a2enmod lwt
$ sudo service apache2 restart
}}}

Now the Apache HTTP Server will pass `.lua` files globally to `mod_lwt`. Of course, like any module, `mod_lwt` can also be enabled on a site-by-site basis.

Create a basic test page in `/var/www/test.lua`:

{{{
request, args = ...

local request_fields = { "protocol", "hostname", "path", "path_info",
        "method", "filename", "filedir", "user", "auth_type",
        "local_ip", "remote_ip"
}

httpd.set_content_type("text/plain")
httpd.write("Hello Lua World\r\n")
for _, key in ipairs(request_fields) do
        httpd.write(key .." -> " .. (request[key] or "(not set)") .. "\r\n")
end
}}}

Test the installation by pointing your browser to `http://<host>/test.lua.`